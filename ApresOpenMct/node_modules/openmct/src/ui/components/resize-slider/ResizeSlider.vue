<template>
<div
    class="resize-slider"
    :class="[resize_type_cssClass, resize_icon_cssClass]"
    @mousedown="start"
></div>
</template>

<script>
const MIN_THRESHOLD_PX = 40;

export default {
    props: {
        type: {
            type: String,
            default: '',
            validator: function (value) {
                return ['vertical', 'horizontal'].indexOf(value) !== -1;
            }
        },
        label: {
            type: String,
            default: ''
        }
    },
    data() {
        return {
            resizing: false
        };
    },
    computed: {
        resize_type_cssClass() {
            return `resize-slider__handle__${this.type}`;
        },
        resize_icon_cssClass() {
            if (this.type === 'vertical') {
                return 'icon-arrow-down';
            } else if (this.type === 'horizontal') {
                return 'icon-arrow-left';
            }

            return '';
        }
    },
    beforeMount() {
        this.styleProp = (this.type === 'vertical') ? 'left' : 'top';
    },
    methods: {
        trackSize: function () {
            if (this.type === 'vertical') {
                this.initial = this.$el.offsetLeft;
            } else if (this.type === 'horizontal') {
                this.initial = this.$el.offsetTop;
            }
        },
        getPosition: function (event) {
            return this.type === 'vertical'
                ? event.pageX
                : event.pageY;
        },
        getNewSize: function (event) {
            let delta = this.getPosition(event) - this.startPosition;

            //TODO: Check this math works when size is increased OR decreased
            return `${this.initial + delta}px`;
        },
        updatePosition: function (event) {
            let size = this.getNewSize(event);
            let intSize = parseInt(size.substr(0, size.length - 2), 10);
            if (intSize < MIN_THRESHOLD_PX) {
                intSize = MIN_THRESHOLD_PX;
            }

            this.$el.style[this.styleProp] = `${intSize}px`;
        },
        start: function (event) {
            event.preventDefault(); // stop from firing drag event

            this.startPosition = this.getPosition(event);
            document.body.addEventListener('mousemove', this.updatePosition);
            document.body.addEventListener('mouseup', this.end);
            this.resizing = true;
            this.trackSize();
        },
        end: function (event) {
            document.body.removeEventListener('mousemove', this.updatePosition);
            document.body.removeEventListener('mouseup', this.end);
            this.resizing = false;
            this.trackSize();
            this.$emit('sizeUpdated', this.initial);
        }
    }
};
</script>
